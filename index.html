<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—è©è¯æƒ³å‰µé€ åŠ›è©•åˆ†ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .scoring-criteria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .criteria-item {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .criteria-item:hover {
            transform: translateY(-2px);
        }
        
        .criteria-item h4 {
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .scoring-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .data-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }
        
        .input-group input, .input-group textarea {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        .response-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .response-item:hover {
            border-color: #4299e1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .response-item.unscored {
            border: 3px solid #e53e3e;
            background: #fed7d7;
            box-shadow: 0 0 10px rgba(229, 62, 62, 0.3);
        }
        
        .response-item.unscored:hover {
            border-color: #c53030;
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.4);
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .response-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .delete-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .delete-btn:hover {
            background: #c53030;
        }
        
        .rating-scale {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 15px;
        }
        
        .scale-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #718096;
        }
        
        .radio-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            width: 100%;
            margin: 10px 0;
        }
        
        .radio-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input[type="radio"] {
            width: 28px;
            height: 28px;
            cursor: pointer;
            transform: scale(1.2);
        }
        
        .radio-item label {
            font-weight: 600;
            color: #4299e1;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #38b2ac, #319795);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(56, 178, 172, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        
        .actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .progress-info {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .data-input {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
            
            .radio-group {
                gap: 10px;
            }
            
            .radio-item input[type="radio"] {
                width: 24px;
                height: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å­—è©è¯æƒ³å‰µé€ åŠ›è©•åˆ†ç³»çµ±</h1>
            <p>è©•å¯©å°ˆç”¨è©•åˆ†å¹³å°</p>
        </div>
        
        <div class="instructions">
            <h2>ğŸ“‹ å‰µé€ åŠ›è©•åˆ†æ¨™æº–ï¼ˆåŸºæ–¼Torranceç†è«–ï¼‰</h2>
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; text-align: center;">
                <h3 style="margin-bottom: 15px; font-size: 1.8em;">è©•åˆ†å£è¨£ï¼šã€ŒæŠ“æ·±ã€è·³é ã€å°‘è¦‹ã€èªªé€ã€</h3>
                <p style="font-size: 1.2em; margin-bottom: 10px;"><strong>æ·± + é  + ç¨€ + é€ = é«˜åˆ†</strong></p>
                <p style="font-size: 1em; opacity: 0.9;">è«‹ç¶œåˆè€ƒé‡å››å€‹é¢å‘ï¼Œçµ¦äºˆ1-5åˆ†æ•´é«”è©•åˆ†</p>
            </div>
            
            <div class="torrance-dimensions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <div class="dimension-card" style="background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="background: #4299e1; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold;">1</span>
                        æ•è¦ºæ€§ (Sensitivity)
                    </h4>
                    <p style="font-weight: 600; color: #4299e1; margin-bottom: 8px;">æŠ“æ·±ï¼šæœ‰æ²’æœ‰ç™¼ç¾é¡Œç›®èƒŒå¾Œçš„éš±è—è­°é¡Œï¼Ÿ</p>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>ä½åˆ†ï¼š</strong>åªé»åˆ°æœ€è¡¨é¢çš„è¯æƒ³</li>
                        <li><strong>ä¸­åˆ†ï¼š</strong>çœ‹å‡ºä¸€èˆ¬éš±å«è­°é¡Œ</li>
                        <li><strong>é«˜åˆ†ï¼š</strong>æ•æ‰æ·±å±¤æˆ–å†·é–€è­°é¡Œï¼Œå¼•äººåæ€</li>
                    </ul>
                </div>
                
                <div class="dimension-card" style="background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="background: #38b2ac; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold;">2</span>
                        è®Šé€šæ€§ (Flexibility)
                    </h4>
                    <p style="font-weight: 600; color: #38b2ac; margin-bottom: 8px;">è·³é ï¼šæ¦‚å¿µè·¨å¤šé ã€è§’åº¦è®ŠåŒ–å¤šå¤§ï¼Ÿ</p>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>ä½åˆ†ï¼š</strong>ä¾·é™å–®ä¸€è·¯å¾‘</li>
                        <li><strong>ä¸­åˆ†ï¼š</strong>å°å¹…æ›é¡åˆ¥</li>
                        <li><strong>é«˜åˆ†ï¼š</strong>è·¨åŸŸæˆ–å¤šè§’åº¦åˆ‡æ›</li>
                    </ul>
                </div>
                
                <div class="dimension-card" style="background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="background: #805ad5; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold;">3</span>
                        åŸå‰µæ€§ (Originality)
                    </h4>
                    <p style="font-weight: 600; color: #805ad5; margin-bottom: 8px;">å°‘è¦‹ï¼šç­”æ¡ˆæ˜¯ä¸æ˜¯ç½•è¦‹æˆ–æ„æ–™ä¹‹å¤–ï¼Ÿ</p>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>ä½åˆ†ï¼š</strong>å¸¸è¦‹ã€è€æ¢—</li>
                        <li><strong>ä¸­åˆ†ï¼š</strong>ç¨å…·æ–°æ„</li>
                        <li><strong>é«˜åˆ†ï¼š</strong>ç½•è¦‹ä¸”å‡ºå…¶ä¸æ„</li>
                    </ul>
                </div>
                
                <div class="dimension-card" style="background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="background: #ed8936; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold;">4</span>
                        å‘¨å…¨æ€§ (Elaboration)
                    </h4>
                    <p style="font-weight: 600; color: #ed8936; margin-bottom: 8px;">èªªé€ï¼šæ•˜è¿°æœ‰æ²’æœ‰è£œå……æ•…äº‹ã€éš±å–»ã€ç´°ç¯€ï¼Ÿ</p>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                        <li><strong>ä½åˆ†ï¼š</strong>å¹¾ä¹ç„¡è£œå……</li>
                        <li><strong>ä¸­åˆ†ï¼š</strong>åŸºæœ¬æè¿°</li>
                        <li><strong>é«˜åˆ†ï¼š</strong>æ•…äº‹åŒ–ã€éš±å–»ã€ç´°ç¯€è±å¯Œ</li>
                    </ul>
                </div>
            </div>
            
            <div class="scoring-summary" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; padding: 20px; border-radius: 12px;">
                <h3 style="margin-bottom: 15px; text-align: center;">ğŸ“Š ç¶œåˆè©•åˆ†æ¨™æº–</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center;">
                        <h4 style="margin-bottom: 5px;">1-2åˆ†ï¼ˆä½ï¼‰</h4>
                        <p style="font-size: 0.9em; opacity: 0.9;">è¡¨é¢ã€å–®ä¸€è·¯å¾‘ã€å¸¸è¦‹ã€æ²’ç´°ç¯€</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="margin-bottom: 5px;">3åˆ†ï¼ˆä¸­ï¼‰</h4>
                        <p style="font-size: 0.9em; opacity: 0.9;">æœ‰å‰µæ„æ„åœ–ï¼Œä½†è·¨åŸŸ/ç´°ç¯€ä»æœ‰é™</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="margin-bottom: 5px;">4-5åˆ†ï¼ˆé«˜ï¼‰</h4>
                        <p style="font-size: 0.9em; opacity: 0.9;">æ·±åº¦è­°é¡Œ+å¤§è·¨åŸŸ+ç½•è¦‹+æ•…äº‹è±å¯Œ</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="scoring-section">
            <h2>ğŸ¯ è³‡æ–™è¼¸å…¥èˆ‡è©•åˆ†</h2>
            
            <!-- æª”æ¡ˆä¸Šå‚³å€åŸŸ -->
            <div class="upload-section" style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #2d3748;">ğŸ“ ä¸Šå‚³Excel/CSVæª”æ¡ˆ</h3>
                <div class="upload-area" style="border: 2px dashed #4299e1; border-radius: 12px; padding: 30px; text-align: center; background: #f7fafc; margin-bottom: 15px;">
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;" onchange="handleFileUpload(event)">
                    <div onclick="document.getElementById('fileInput').click()" style="cursor: pointer;">
                        <div style="font-size: 3em; color: #4299e1; margin-bottom: 10px;">ğŸ“Š</div>
                        <p style="font-size: 1.2em; color: #4a5568; margin-bottom: 10px;">é»æ“Šé¸æ“‡æª”æ¡ˆ</p>
                        <p style="color: #718096;">æ”¯æ´æ ¼å¼ï¼šCSV, Excel (.xlsx, .xls)</p>
                        <p style="color: #718096; font-size: 0.9em;">æª”æ¡ˆæ ¼å¼ï¼šgroup, participant_id, item, response</p>
                    </div>
                </div>
                <div class="file-info" id="fileInfo" style="display: none; background: #e6fffa; border: 1px solid #38b2ac; border-radius: 8px; padding: 15px; color: #234e52;">
                    <strong>å·²ä¸Šå‚³æª”æ¡ˆï¼š</strong><span id="fileName"></span><br>
                    <strong>è³‡æ–™ç­†æ•¸ï¼š</strong><span id="dataCount"></span>
                </div>
            </div>
            
            <!-- æ‰‹å‹•è¼¸å…¥å€åŸŸ -->
            <div class="manual-input" style="border-top: 2px solid #e2e8f0; padding-top: 30px;">
                <h3 style="margin-bottom: 15px; color: #2d3748;">âœï¸ æ‰‹å‹•è¼¸å…¥ï¼ˆå¯é¸ï¼‰</h3>
                <div class="data-input">
                    <div class="input-group">
                        <label for="stimulusWord">åˆºæ¿€è©ï¼š</label>
                        <input type="text" id="stimulusWord" placeholder="ä¾‹å¦‚ï¼šMilk">
                    </div>
                    <div class="input-group">
                        <label for="participantResponse">åƒèˆ‡è€…å›ç­”ï¼š</label>
                        <input type="text" id="participantResponse" placeholder="ä¾‹å¦‚ï¼šMilk tea">
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="addResponse()">â• æ–°å¢å›ç­”</button>
                </div>
            </div>
            
            <div id="responsesList"></div>
            
            <div class="progress-info" id="progressInfo" style="display: none;">
                å·²è©•åˆ†ï¼š<span id="scoredCount">0</span> / ç¸½æ•¸ï¼š<span id="totalCount">0</span>
            </div>
            
            <div class="actions">
                <button class="btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                <button class="btn btn-success" onclick="exportToExcel()">ğŸ“Š åŒ¯å‡ºExcelæª”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <script>
        let responses = [];
        let currentId = 1;

        // æª”æ¡ˆä¸Šå‚³è™•ç†
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileName = file.name;
            const fileExtension = fileName.split('.').pop().toLowerCase();
            
            document.getElementById('fileName').textContent = fileName;
            
            if (fileExtension === 'csv') {
                // è™•ç†CSVæª”æ¡ˆ
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        processUploadedData(results.data);
                        showFileInfo(fileName, results.data.length);
                    },
                    error: function(error) {
                        alert('CSVæª”æ¡ˆè®€å–éŒ¯èª¤ï¼š' + error.message);
                    }
                });
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                // è™•ç†Excelæª”æ¡ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        processUploadedData(jsonData);
                        showFileInfo(fileName, jsonData.length);
                    } catch (error) {
                        alert('Excelæª”æ¡ˆè®€å–éŒ¯èª¤ï¼š' + error.message);
                    }
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert('ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ï¼Œè«‹ä¸Šå‚³CSVæˆ–Excelæª”æ¡ˆ');
            }
        }

        function processUploadedData(data) {
            // æ¸…ç©ºç¾æœ‰è³‡æ–™
            responses = [];
            currentId = 1;
            
            // è™•ç†ä¸Šå‚³çš„è³‡æ–™
            data.forEach(row => {
                // è™•ç†å¯èƒ½çš„æ¬„ä½åç¨±è®ŠåŒ–
                const group = row.group || row.Group || '';
                const participantId = row.participant_id || row['participant_id'] || row.ParticipantId || '';
                const item = row.item || row.Item || row.stimulus || row.Stimulus || '';
                const response = row.response || row.Response || row.answer || row.Answer || '';
                
                if (item && response) {
                    const newResponse = {
                        id: currentId++,
                        group: group,
                        participantId: participantId,
                        stimulusWord: item,
                        participantResponse: response,
                        score: null
                    };
                    responses.push(newResponse);
                }
            });
            
            renderResponses();
            updateProgress();
        }

        function showFileInfo(fileName, dataCount) {
            document.getElementById('fileName').textContent = fileName;
            document.getElementById('dataCount').textContent = dataCount;
            document.getElementById('fileInfo').style.display = 'block';
        }

        function addResponse() {
            const stimulusWord = document.getElementById('stimulusWord').value.trim();
            const participantResponse = document.getElementById('participantResponse').value.trim();
            
            if (!stimulusWord || !participantResponse) {
                alert('è«‹å¡«å¯«åˆºæ¿€è©å’Œåƒèˆ‡è€…å›ç­”');
                return;
            }
            
            const response = {
                id: currentId++,
                stimulusWord: stimulusWord,
                participantResponse: participantResponse,
                score: null
            };
            
            responses.push(response);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('stimulusWord').value = '';
            document.getElementById('participantResponse').value = '';
            
            renderResponses();
            updateProgress();
        }

        function renderResponses() {
            const container = document.getElementById('responsesList');
            container.innerHTML = '';
            
            responses.forEach((response, index) => {
                const responseDiv = document.createElement('div');
                responseDiv.className = 'response-item';
                
                // å¦‚æœæœªè©•åˆ†ï¼Œæ·»åŠ ç´…è‰²å¤–æ¡†æ¨£å¼
                if (response.score === null) {
                    responseDiv.classList.add('unscored');
                }
                
                responseDiv.innerHTML = `
                    <div class="response-header">
                        <div style="width: 100%;">
                            <div style="text-align: center; margin-bottom: 8px;">
                                <span style="background: #4299e1; color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.9em; margin-right: 10px;">
                                    ${index + 1}/${responses.length}
                                </span>
                                ${response.participantId ? `<span style="background: #805ad5; color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.9em; margin-right: 10px;">
                                    ID: ${response.participantId}
                                </span>` : ''}
                                ${response.score === null ? `<span style="background: #e53e3e; color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.9em; animation: pulse 2s infinite;">
                                    âš ï¸ æœªè©•åˆ†
                                </span>` : ''}
                            </div>
                            <div style="text-align: center; font-size: 1.2em;">
                                <strong>åˆºæ¿€è©ï¼š</strong>${response.stimulusWord}ã€€
                                <strong>å›ç­”ï¼š</strong><span class="response-text">${response.participantResponse}</span>
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deleteResponse(${response.id})">åˆªé™¤</button>
                    </div>
                    <div class="rating-scale">
                        <div style="width: 100%;">
                            <div class="scale-labels">
                                <span>1-2åˆ†ï¼ˆä½ï¼‰<br><small>è¡¨é¢ã€å–®ä¸€ã€å¸¸è¦‹</small></span>
                                <span>3åˆ†ï¼ˆä¸­ï¼‰<br><small>æœ‰å‰µæ„ä½†æœ‰é™</small></span>
                                <span>4-5åˆ†ï¼ˆé«˜ï¼‰<br><small>æ·±+é +ç¨€+é€</small></span>
                            </div>
                            <div class="radio-group">
                                ${[1, 2, 3, 4, 5].map(score => `
                                    <div class="radio-item">
                                        <input type="radio" 
                                               id="score_${response.id}_${score}" 
                                               name="score_${response.id}" 
                                               value="${score}"
                                               ${response.score == score ? 'checked' : ''}
                                               onchange="updateScore(${response.id}, ${score})">
                                        <label for="score_${response.id}_${score}">${score}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(responseDiv);
            });
        }

        function updateScore(responseId, score) {
            const response = responses.find(r => r.id === responseId);
            if (response) {
                response.score = score;
                updateProgress();
                // é‡æ–°æ¸²æŸ“ä»¥ç§»é™¤ç´…è‰²å¤–æ¡†
                renderResponses();
            }
        }

        function deleteResponse(responseId) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å›ç­”å—ï¼Ÿ')) {
                responses = responses.filter(r => r.id !== responseId);
                renderResponses();
                updateProgress();
            }
        }

        function updateProgress() {
            const totalCount = responses.length;
            const scoredCount = responses.filter(r => r.score !== null).length;
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('scoredCount').textContent = scoredCount;
            
            const progressInfo = document.getElementById('progressInfo');
            if (totalCount > 0) {
                progressInfo.style.display = 'block';
            } else {
                progressInfo.style.display = 'none';
            }
        }

        function clearAll() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                responses = [];
                currentId = 1;
                renderResponses();
                updateProgress();
            }
        }

        function exportToExcel() {
            if (responses.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º');
                return;
            }
            
            const unscored = responses.filter(r => r.score === null);
            if (unscored.length > 0) {
                if (!confirm(`é‚„æœ‰ ${unscored.length} å€‹å›ç­”å°šæœªè©•åˆ†ï¼Œç¢ºå®šè¦åŒ¯å‡ºå—ï¼Ÿ`)) {
                    return;
                }
            }
            
            // æº–å‚™åŒ¯å‡ºè³‡æ–™
            const exportData = responses.map((response, index) => ({
                'åºè™Ÿ': index + 1,
                'çµ„åˆ¥': response.group || '',
                'åƒèˆ‡è€…ID': response.participantId || '',
                'åˆºæ¿€è©': response.stimulusWord,
                'åƒèˆ‡è€…å›ç­”': response.participantResponse,
                'å‰µé€ åŠ›è©•åˆ†': response.score || 'æœªè©•åˆ†',
                'è©•åˆ†æ™‚é–“': new Date().toLocaleString('zh-TW')
            }));
            
            // å»ºç«‹å·¥ä½œç°¿
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å‰µé€ åŠ›è©•åˆ†çµæœ');
            
            // è¨­å®šæ¬„ä½å¯¬åº¦
            ws['!cols'] = [
                { width: 8 },   // åºè™Ÿ
                { width: 12 },  // çµ„åˆ¥
                { width: 12 },  // åƒèˆ‡è€…ID
                { width: 15 },  // åˆºæ¿€è©
                { width: 20 },  // åƒèˆ‡è€…å›ç­”
                { width: 12 },  // å‰µé€ åŠ›è©•åˆ†
                { width: 20 }   // è©•åˆ†æ™‚é–“
            ];
            
            // åŒ¯å‡ºæª”æ¡ˆ
            const fileName = `å‰µé€ åŠ›è©•åˆ†çµæœ_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('Excelæª”æ¡ˆå·²æˆåŠŸåŒ¯å‡ºï¼');
        }

        // é é¢è¼‰å…¥æ™‚çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });

        // ç›£è½Enteréµä»¥å¿«é€Ÿæ–°å¢å›ç­”
        document.getElementById('participantResponse').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addResponse();
            }
        });
    </script>
</body>
</html>
